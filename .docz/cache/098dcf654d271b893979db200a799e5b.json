{"remainingRequest":"/Users/apple/Documents/project/antd-doddle/node_modules/babel-loader/lib/index.js?{\"presets\":[\"@babel/preset-env\",\"@babel/preset-react\",[\"/Users/apple/Documents/project/antd-doddle/node_modules/babel-preset-docz/dist/index.js\",{\"flow\":true,\"typescript\":false,\"parseProps\":true}]],\"plugins\":[\"@babel/plugin-proposal-object-rest-spread\",[\"@babel/plugin-proposal-decorators\",{\"legacy\":true}],\"@babel/plugin-proposal-class-properties\",\"@babel/plugin-transform-classes\",[\"/Users/apple/Documents/project/antd-doddle/node_modules/docz-utils/lib/named-asset-import.js\",{\"loaderMap\":{\"svg\":{\"ReactComponent\":\"@svgr/webpack?-prettier,-svgo![path]\"}}}],\"/Users/apple/Documents/project/antd-doddle/node_modules/react-hot-loader/babel.js\"],\"babelrc\":false,\"cacheCompression\":false,\"compact\":false}!/Users/apple/Documents/project/antd-doddle/src/components/DaynamicForm.js","dependencies":[{"path":"/Users/apple/Documents/project/antd-doddle/src/components/DaynamicForm.js","mtime":1551191122128},{"path":"/Users/apple/Documents/project/antd-doddle/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/apple/Documents/project/antd-doddle/node_modules/babel-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["var _class,\n    _temp,\n    _jsxFileName = \"/Users/apple/Documents/project/antd-doddle/src/components/DaynamicForm.js\";\n\n(function () {\n  var enterModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).enterModule;\n  enterModule && enterModule(module);\n})();\n\nfunction _typeof(obj) { if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; var ownKeys = Object.keys(source); if (typeof Object.getOwnPropertySymbols === 'function') { ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) { return Object.getOwnPropertyDescriptor(source, sym).enumerable; })); } ownKeys.forEach(function (key) { _defineProperty(target, key, source[key]); }); } return target; }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } return _assertThisInitialized(self); }\n\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); if (superClass) _setPrototypeOf(subClass, superClass); }\n\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\n\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) { var desc = {}; Object['ke' + 'ys'](descriptor).forEach(function (key) { desc[key] = descriptor[key]; }); desc.enumerable = !!desc.enumerable; desc.configurable = !!desc.configurable; if ('value' in desc || desc.initializer) { desc.writable = true; } desc = decorators.slice().reverse().reduce(function (desc, decorator) { return decorator(target, property, desc) || desc; }, desc); if (context && desc.initializer !== void 0) { desc.value = desc.initializer ? desc.initializer.call(context) : void 0; desc.initializer = undefined; } if (desc.initializer === void 0) { Object['define' + 'Property'](target, property, desc); desc = null; } return desc; }\n\nimport React from 'react';\nimport bind from 'bind-decorator';\nimport { Button } from 'antd';\nimport styles from './index.less'; // 根据方向，找出指定索引的有效的上一或下一数据项\n\nfunction findValid(arr, index) {\n  var dir = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n  var target = index + dir;\n\n  for (var i = target; dir === 1 && i < arr.length || dir === -1 && i >= 0; i += dir) {\n    if (!arr[i].deleteFlag) {\n      target = i;\n      break;\n    }\n  }\n\n  return target;\n}\n\nvar DaynamicForm = (_class = (_temp =\n/*#__PURE__*/\nfunction (_React$Component) {\n  _inherits(DaynamicForm, _React$Component);\n\n  function DaynamicForm(props) {\n    var _this;\n\n    _classCallCheck(this, DaynamicForm);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(DaynamicForm).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handlMoveUp\", function (index) {\n      return function () {\n        var rules = _this.state.rules;\n\n        var _rules$index = rules[index],\n            key = _rules$index.key,\n            temp = _objectWithoutProperties(_rules$index, [\"key\"]);\n\n        var lastIndex = findValid(rules, key, -1);\n        rules[index] = _objectSpread({}, rules[lastIndex], {\n          key: key\n        });\n        rules[lastIndex] = _objectSpread({}, temp, {\n          key: lastIndex\n        });\n\n        _this.setState({\n          rules: _toConsumableArray(rules)\n        });\n\n        _this.trigger(rules);\n      };\n    });\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"handlMoveDown\", function (index) {\n      return function () {\n        var rules = _this.state.rules;\n\n        var _rules$index2 = rules[index],\n            key = _rules$index2.key,\n            temp = _objectWithoutProperties(_rules$index2, [\"key\"]);\n\n        var nextIndex = findValid(rules, key, 1);\n        rules[index] = _objectSpread({}, rules[nextIndex], {\n          key: key\n        });\n        rules[nextIndex] = _objectSpread({}, temp, {\n          key: nextIndex\n        });\n\n        _this.setState({\n          rules: _toConsumableArray(rules)\n        });\n\n        _this.trigger(rules);\n      };\n    });\n\n    var _props$value = props.value,\n        value = _props$value === void 0 ? [{\n      key: 0\n    }] : _props$value;\n    _this.state = {\n      rules: value.map(function (ele, key) {\n        return _objectSpread({}, ele, {\n          key: key\n        });\n      })\n    };\n    return _this;\n  }\n\n  _createClass(DaynamicForm, [{\n    key: \"handlMinus\",\n    value: function handlMinus(index) {\n      var rules = this.state.rules;\n      rules[index].deleteFlag = true;\n      this.setState({\n        rules: _toConsumableArray(rules)\n      });\n      this.trigger(rules);\n    }\n  }, {\n    key: \"handlAdd\",\n    value: function handlAdd() {\n      var rules = this.state.rules;\n      rules = rules.concat([{\n        value: undefined,\n        key: rules.length\n      }]);\n      this.setState({\n        rules: _toConsumableArray(rules)\n      });\n      this.trigger(rules);\n    }\n  }, {\n    key: \"handleChange\",\n    value: function handleChange(val, index, key) {\n      var rules = this.state.rules;\n      rules[index][key] = val;\n      this.setState({\n        rules: _toConsumableArray(rules)\n      });\n      this.trigger(rules);\n    }\n  }, {\n    key: \"trigger\",\n    value: function trigger(res) {\n      var onChange = this.props.onChange; // 虽说Res的值已经用this.setState更新过，但方法是异步的，所以不能直接用this.state\n\n      onChange && onChange(res.filter(function (e) {\n        return !e.deleteFlag;\n      }));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props = this.props,\n          children = _this$props.children,\n          canMove = _this$props.canMove;\n      var rules = this.state.rules;\n      var actions = {\n        handlAdd: this.handlAdd,\n        handlMinus: this.handlMinus,\n        handleChange: this.handleChange\n      };\n      var validDatas = rules.filter(function (rule) {\n        return !rule.deleteFlag;\n      });\n      var length = validDatas.length - 1;\n      return React.createElement(\"div\", {\n        className: styles.FullReduction,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 91\n        },\n        __self: this\n      }, validDatas.map(function (rule, index) {\n        return React.createElement(\"div\", {\n          key: rule.key,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 93\n          },\n          __self: this\n        }, children(rule, actions), index ? React.createElement(Button, {\n          style: {\n            marginLeft: 10\n          },\n          type: \"primary\",\n          shape: \"circle\",\n          icon: \"minus\",\n          onClick: function onClick() {\n            return _this2.handlMinus(rule.key);\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 96\n          },\n          __self: this\n        }) : React.createElement(Button, {\n          style: {\n            marginLeft: 10\n          },\n          onClick: _this2.handlAdd,\n          type: \"primary\",\n          shape: \"circle\",\n          icon: \"plus\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 103\n          },\n          __self: this\n        }), canMove && index > 0 && React.createElement(Button, {\n          style: {\n            marginLeft: 10\n          },\n          onClick: _this2.handlMoveUp(rule.key),\n          type: \"primary\",\n          shape: \"circle\",\n          icon: \"up\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 113\n          },\n          __self: this\n        }), canMove && index < length && React.createElement(Button, {\n          style: {\n            marginLeft: 10\n          },\n          onClick: _this2.handlMoveDown(rule.key),\n          type: \"primary\",\n          shape: \"circle\",\n          icon: \"down\",\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 123\n          },\n          __self: this\n        }));\n      }));\n    }\n  }]);\n\n  return DaynamicForm;\n}(React.Component), _temp), (_applyDecoratedDescriptor(_class.prototype, \"handlMinus\", [bind], Object.getOwnPropertyDescriptor(_class.prototype, \"handlMinus\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"handlAdd\", [bind], Object.getOwnPropertyDescriptor(_class.prototype, \"handlAdd\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"handleChange\", [bind], Object.getOwnPropertyDescriptor(_class.prototype, \"handleChange\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"trigger\", [bind], Object.getOwnPropertyDescriptor(_class.prototype, \"trigger\"), _class.prototype)), _class);\nexport { DaynamicForm as default };\n;\n\n(function () {\n  var reactHotLoader = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).default;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(findValid, \"findValid\", \"/Users/apple/Documents/project/antd-doddle/src/components/DaynamicForm.js\");\n  reactHotLoader.register(DaynamicForm, \"DaynamicForm\", \"/Users/apple/Documents/project/antd-doddle/src/components/DaynamicForm.js\");\n})();\n\n;\n\n(function () {\n  var leaveModule = (typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal : require('react-hot-loader')).leaveModule;\n  leaveModule && leaveModule(module);\n})();\n\nDaynamicForm.__docgenInfo = {\n  \"description\": \"\",\n  \"methods\": [{\n    \"name\": \"handlMoveUp\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [{\n      \"name\": \"index\",\n      \"type\": null\n    }],\n    \"returns\": null\n  }, {\n    \"name\": \"handlMoveDown\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [{\n      \"name\": \"index\",\n      \"type\": null\n    }],\n    \"returns\": null\n  }, {\n    \"name\": \"handlMinus\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [{\n      \"name\": \"index\",\n      \"type\": null\n    }],\n    \"returns\": null\n  }, {\n    \"name\": \"handlAdd\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [],\n    \"returns\": null\n  }, {\n    \"name\": \"handleChange\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [{\n      \"name\": \"val\",\n      \"type\": null\n    }, {\n      \"name\": \"index\",\n      \"type\": null\n    }, {\n      \"name\": \"key\",\n      \"type\": null\n    }],\n    \"returns\": null\n  }, {\n    \"name\": \"trigger\",\n    \"docblock\": null,\n    \"modifiers\": [],\n    \"params\": [{\n      \"name\": \"res\",\n      \"type\": null\n    }],\n    \"returns\": null\n  }],\n  \"displayName\": \"DaynamicForm\"\n};",{"version":3,"sources":["/Users/apple/Documents/project/antd-doddle/src/components/DaynamicForm.js"],"names":["React","bind","Button","styles","findValid","arr","index","dir","target","i","length","deleteFlag","DaynamicForm","props","rules","state","key","temp","lastIndex","setState","trigger","nextIndex","value","map","ele","concat","undefined","val","res","onChange","filter","e","children","canMove","actions","handlAdd","handlMinus","handleChange","validDatas","rule","FullReduction","marginLeft","handlMoveUp","handlMoveDown","Component"],"mappings":"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","sourcesContent":["import React from 'react';\nimport bind from 'bind-decorator';\nimport { Button } from 'antd';\nimport styles from './index.less';\n\n// 根据方向，找出指定索引的有效的上一或下一数据项\nfunction findValid(arr, index, dir = 1) {\n  let target = index + dir;\n  for (let i = target; ((dir === 1 && i < arr.length) || (dir === -1 && i >= 0)); i += dir) {\n    if (!arr[i].deleteFlag) {\n      target = i;\n      break;\n    }\n  }\n  return target;\n}\n\nexport default class DaynamicForm extends React.Component {\n  constructor(props) {\n    super(props);\n    const { value = [{ key: 0 }] } = props;\n    this.state = {\n      rules: value.map((ele, key) => ({ ...ele, key })),\n    };\n  }\n  handlMoveUp = index => () => {\n    const { rules } = this.state;\n    const { key, ...temp } = rules[index];\n    const lastIndex = findValid(rules, key, -1);\n    rules[index] = { ...rules[lastIndex], key };\n    rules[lastIndex] = { ...temp, key: lastIndex };\n    this.setState({\n      rules: [...rules]\n    });\n    this.trigger(rules);\n  }\n  handlMoveDown = index => () => {\n    const { rules } = this.state;\n    const { key, ...temp } = rules[index];\n    const nextIndex = findValid(rules, key, 1);\n    rules[index] = { ...rules[nextIndex], key };\n    rules[nextIndex] = { ...temp, key: nextIndex };\n    this.setState({\n      rules: [...rules]\n    });\n    this.trigger(rules);\n  }\n  @bind\n  handlMinus(index) {\n    const { rules } = this.state;\n    rules[index].deleteFlag = true;\n    this.setState({\n      rules: [...rules]\n    });\n    this.trigger(rules);\n  }\n  @bind\n  handlAdd() {\n    let { rules } = this.state;\n    rules = rules.concat([{ value: undefined, key: rules.length }]);\n    this.setState({ rules: [...rules] });\n    this.trigger(rules);\n  }\n  @bind\n  handleChange(val, index, key) {\n    const { rules } = this.state;\n    rules[index][key] = val;\n    this.setState({\n      rules: [...rules]\n    });\n    this.trigger(rules);\n  }\n  @bind\n  trigger(res) {\n    const { onChange } = this.props;\n    // 虽说Res的值已经用this.setState更新过，但方法是异步的，所以不能直接用this.state\n    onChange && onChange(res.filter(e => !e.deleteFlag));\n  }\n\n  render() {\n    const { children, canMove } = this.props;\n    const { rules } = this.state;\n    const actions = {\n      handlAdd: this.handlAdd,\n      handlMinus: this.handlMinus,\n      handleChange: this.handleChange,\n    };\n    const validDatas = rules.filter(rule => !rule.deleteFlag);\n    const length = validDatas.length - 1;\n    return (\n      <div className={styles.FullReduction}>\n        {validDatas.map((rule, index) => (\n          <div key={rule.key}>\n            {children(rule, actions)}\n            {index ?\n              <Button\n                style={{ marginLeft: 10 }}\n                type=\"primary\"\n                shape=\"circle\"\n                icon=\"minus\"\n                onClick={() => this.handlMinus(rule.key)}\n              /> :\n              <Button\n                style={{ marginLeft: 10 }}\n                onClick={this.handlAdd}\n                type=\"primary\"\n                shape=\"circle\"\n                icon=\"plus\"\n              />\n            }\n            {/* 第一条只能下移 */}\n            {canMove && index > 0 &&\n              <Button\n                style={{ marginLeft: 10 }}\n                onClick={this.handlMoveUp(rule.key)}\n                type=\"primary\"\n                shape=\"circle\"\n                icon=\"up\"\n              />\n            }\n            {/* 最后一条只能上移 */}\n            {canMove && (index < length) &&\n              <Button\n                style={{ marginLeft: 10 }}\n                onClick={this.handlMoveDown(rule.key)}\n                type=\"primary\"\n                shape=\"circle\"\n                icon=\"down\"\n              />\n            }\n          </div>)\n        )}\n      </div>\n    );\n  }\n}\n"]}]}